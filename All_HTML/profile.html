<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Profile</title>
  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
     <link rel="stylesheet" href="../All_CSS/main.css">

</head>
<body>
  <!-- Navbar Include (if you have one) -->
<div id="navbar-placeholder"></div>

<script>
  fetch('nav.html')
    .then(response => response.text())
    .then(data => document.getElementById('navbar-placeholder').innerHTML = data);
</script>
  <!-- Profile & Counters Section -->
  <section class="profile py-5">
    <div class=" container">
      <div class="row align-items-center">
        <div class="col-md-4 text-center mb-4 mb-md-0">
          <img
            id="profileImg"
            src="https://i.pravatar.cc/200"
            alt="Profile"
            class="rounded-circle"
            style="width:200px;height:200px;object-fit:cover;"
          />
          <h2 class="mt-3 profiletxt" id="username">Guest</h2>
        </div>
        <div class="col-md-8">
          <div class="row text-center">
            <!-- Five counters -->
            <script>
              const lists = ['favourite','library','openCover','closedCover','dustyShelves'];
              lists.forEach(key => {
                document.write(`
                  <div class="col-6 col-lg-4 mb-4">
                    <div class="counter__item">
                      <div class="counter__item__text profiletxt2">
                        <img src="https://img.icons8.com/ios-filled/50/ffffff/book.png" alt="${key}" />
                        <h2 class="counter_num profiletxt" id="count-${key}">0</h2>
                        <p>${key.charAt(0).toUpperCase() + key.slice(1)}</p>
                      </div>
                    </div>
                  </div>
                `);
              });
            </script>
          </div>
        </div>
      </div>  
    </div>
  </section>

  <!-- Book Carousels -->
  <div class="container mt-5"  style=" max-width:1500px;">
    <script>
      lists.forEach(key => {
        document.write(`
          <section class="mb-5">
            <div class="row">
              <div class="col-md-2 d-flex flex-column justify-content-center align-items-center">
                <h3 class="fw-bold text-center lh-base mb-5 align-items-center">${key.charAt(0).toUpperCase() + key.slice(1)}</h3>
                <a href="#" class="btn btn-outline-primary mt-5 homePage-button slider-butt align-items-end ">See All</a>
              </div>
              <div class="col-md-10">
                <div id="carousel-${key}" class="carousel slide" data-bs-ride="carousel">
                  <div class="carousel-inner" id="inner-${key}"></div>
                  <button class="carousel-control-prev" type="button" data-bs-target="#carousel-${key}" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                  </button>
                  <button class="carousel-control-next" type="button" data-bs-target="#carousel-${key}" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                  </button>
                </div>
              </div>
            </div>
          </section>
        `);
      });
    </script>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Data Loader: fetch 10 fiction books for every slider -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const endpoint =
      'https://www.googleapis.com/books/v1/volumes?q=subject:fiction&maxResults=10';

    lists.forEach(listName => {
      fetch(endpoint)
        .then(res => res.json())
        .then(data => {
          const books = (data.items || []).map(item => {
            const info = item.volumeInfo;
            return {
              id: item.id,
              title: info.title || 'No title',
              authors: info.authors || ['Unknown'],
              avg_rating: info.averageRating || 0,
              image_url:
                info.imageLinks?.thumbnail ||
                'https://via.placeholder.com/128x193?text=No+Cover'
            };
          });

          // update counter
          document.getElementById(`count-${listName}`).textContent =
            books.length;

          // build carousel slides
          const inner = document.getElementById(`inner-${listName}`);
          const perSlide =
            window.innerWidth < 576
              ? 1
              : window.innerWidth < 768
              ? 2
              : 4;
          let html = '';

          books.forEach((book, i) => {
            const title =book.title.length > 30 ? book.title.slice(0, 30) + '…' : book.title;
            const authors = book.authors.join(', ');
            const rating = Math.round(book.avg_rating);
      
            const stars = Array.from({ length: 5 }, (_, k) =>
              `<span
                 class="star ${k < rating ? 'filled' : ''}"
                 data-rating="${book.avg_rating.toFixed(1)}"
               >★</span>`
            ).join('');

            if (i % perSlide === 0) {
              html += `<div class="carousel-item ${
                i === 0 ? 'active' : ''
              }"><div class="row gx-2">`;
            }
            html += `
              <div class="col-md-3 col-sm-6 px-1" style="min-height: 400px;">
               <a href="book-detail.html?bookId=${book.id}" class="card-link">
                <div class="card">
                  <img
                    src="${book.image_url}"
                    class="card-img-top"
                    alt="${title}"
                    loading="lazy"
                  >
                  <div class="card-body">
                    <h5 class="card-title card-link">${title}</h5>
                    <p class="card-text card-link author">${authors}</p>
                    <div class="stars" data-rating="${book.avg_rating.toFixed(1)}">
                      ${stars}
                    </div>
                  </div>
                </div>
                </a>
              </div>`;

            if ((i + 1) % perSlide === 0 || i === books.length - 1) {
              html += `</div></div>`;
            }
          });

          inner.innerHTML = html;

          // —— NEW: wire up your data-rating logic on each .star ——
          inner.querySelectorAll('.star').forEach(star => {
            const rv = parseFloat(star.getAttribute('data-rating'));
            // example: store it on the element
            star.ratingValue = rv;
            // example: on hover log it
            star.addEventListener('mouseenter', () => {
              console.log(`Hovered rating: ${rv}`);
            });
            // example: on click alert it
            star.addEventListener('click', () => {
              alert(`You clicked a star with rating: ${rv}`);
            });
          });
          // ————————————————————————————————
        })
        .catch(err => console.error(`Error loading ${listName}:`, err));
    });
  });
</script>
  <div id="footer-placeholder"></div>
  <script>
    fetch('footer.html')
      .then(response => response.text())
      .then(html => {
        const temp = document.createElement('div');
        temp.innerHTML = html;
        const footerEl = temp.querySelector('footer');
        document.getElementById('footer-placeholder').appendChild(footerEl);
      })
      .catch(err => console.error('Error loading footer:', err));
  </script>

</body>
</html>
